import{a as Z}from"/build/_shared/chunk-UYD3XYD3.js";import{a as Y}from"/build/_shared/chunk-XKJ5LF2E.js";import{a as x}from"/build/_shared/chunk-XDNDK56N.js";import"/build/_shared/chunk-KAUQO2FD.js";import"/build/_shared/chunk-7ZNTUDLC.js";import{a as W}from"/build/_shared/chunk-6JFOYO3V.js";import{a as b}from"/build/_shared/chunk-L2TBXS32.js";import{a as h}from"/build/_shared/chunk-JBQJJPFB.js";import{b as i}from"/build/_shared/chunk-SS7AQOQ3.js";import{a as M,b as P,c as R}from"/build/_shared/chunk-2MHSPA7K.js";import{a as N}from"/build/_shared/chunk-WZRQ3RQI.js";import"/build/_shared/chunk-YYMCCM4Y.js";import{a as X}from"/build/_shared/chunk-35S5HMBT.js";import"/build/_shared/chunk-5KYGR3MA.js";import"/build/_shared/chunk-WKQOSWRL.js";import"/build/_shared/chunk-Z5RMMUMH.js";import"/build/_shared/chunk-SUJVG5FV.js";import"/build/_shared/chunk-OMO5CWS2.js";import"/build/_shared/chunk-PVX4NJUU.js";import{a as Q}from"/build/_shared/chunk-B6OA2ZRE.js";import{a as c,b as p,c as u,e as f}from"/build/_shared/chunk-G5A27C7O.js";import{h as l}from"/build/_shared/chunk-NVGVVEPD.js";import{Ea as K,X as j,b as D,oa as E,t as I}from"/build/_shared/chunk-PNJDYZ5P.js";import{e as F,k as T,l as S,p as k,q as $}from"/build/_shared/chunk-GTSSQFHM.js";import{a as J,b as L}from"/build/_shared/chunk-BBTKOQ57.js";import{e as s}from"/build/_shared/chunk-UED2Q7CE.js";var n=s(J()),ee=s(X());var te=s(Z()),ae=s(Q());var se=s(W()),ie=s(Y());var e=s(L());function B(){let{kpiForm:r,users:U,positions:V,can:q}=k(),g=$(),v=F(),[C,H]=(0,n.useState)(!1),[m,y]=(0,n.useState)(r.criteria),[d,w]=(0,n.useState)(r.applicableTo);(0,n.useEffect)(()=>{w(r.applicableTo)},[r]);let A=(t,a)=>{w(o=>({...o,[t]:o[t].includes(a)?o[t].filter(G=>G!==a):[...o[t],a]}))},O=()=>{H(!0)},_=()=>{y([...m,{name:"",maxScore:0,description:""}])},z=t=>{y(m.filter((a,o)=>o!==t))};return(0,e.jsxs)("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl",children:[q?.list&&(0,e.jsx)(l,{asChild:!0,variant:"outline",className:"mb-6 h-11 text-base",children:(0,e.jsxs)(T,{prefetch:"intent",to:"/o/kpi-forms",children:[(0,e.jsx)(D,{className:"mr-2 h-5 w-5"}),"Retour \xE0 la liste"]})}),(0,e.jsxs)(c,{children:[(0,e.jsx)(p,{className:"p-4 sm:p-6",children:(0,e.jsx)(u,{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:"Modifier le Formulaire KPI"})}),(0,e.jsxs)(f,{className:"p-4 sm:p-6 space-y-6",children:[g?.error&&(0,e.jsxs)(M,{variant:"destructive",children:[(0,e.jsx)(I,{className:"h-5 w-5"}),(0,e.jsx)(P,{className:"text-base font-medium",children:"Erreur"}),(0,e.jsx)(R,{className:"text-base",children:g.error})]}),(0,e.jsx)(S,{method:"post",onSubmit:O,children:(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,e.jsx)(i,{htmlFor:"title",className:"text-base font-medium",children:"Titre"}),(0,e.jsx)(N,{id:"title",name:"title",defaultValue:r.title,required:!0,className:"h-11 text-base"})]}),(0,e.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,e.jsx)(i,{htmlFor:"description",className:"text-base font-medium",children:"Description"}),(0,e.jsx)(b,{id:"description",name:"description",defaultValue:r.description,className:"min-h-[120px] text-base p-3"})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h2",{className:"text-lg sm:text-xl font-semibold",children:"Crit\xE8res"}),m.map((t,a)=>(0,e.jsxs)(c,{className:"p-4 sm:p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsxs)("h3",{className:"text-lg font-medium",children:["Crit\xE8re ",a+1]}),(0,e.jsx)(l,{type:"button",variant:"destructive",onClick:()=>z(a),className:"h-11 w-11",children:(0,e.jsx)(K,{className:"h-5 w-5"})})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,e.jsx)(i,{htmlFor:`criterionName${a}`,className:"text-base font-medium",children:"Nom"}),(0,e.jsx)(N,{id:`criterionName${a}`,name:`criterionName${a}`,defaultValue:t.name,required:!0,className:"h-11 text-base"})]}),(0,e.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,e.jsx)(i,{htmlFor:`criterionMaxScore${a}`,className:"text-base font-medium",children:"Note maximale"}),(0,e.jsx)(N,{type:"number",id:`criterionMaxScore${a}`,name:`criterionMaxScore${a}`,defaultValue:t.maxScore,required:!0,min:"1",className:"h-11 text-base"})]}),(0,e.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,e.jsx)(i,{htmlFor:`criterionDescription${a}`,className:"text-base font-medium",children:"Description"}),(0,e.jsx)(b,{id:`criterionDescription${a}`,name:`criterionDescription${a}`,defaultValue:t.description,className:"min-h-[120px] text-base p-3"})]})]})]},a)),(0,e.jsxs)(l,{type:"button",onClick:_,className:"w-full h-11 text-base",children:[(0,e.jsx)(E,{className:"mr-2 h-5 w-5"}),"Ajouter un crit\xE8re"]})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)(i,{className:"text-base font-medium",children:"Assign\xE9 \xE0"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,e.jsxs)(c,{className:"shadow-none border",children:[(0,e.jsx)(p,{className:"p-4",children:(0,e.jsx)(u,{className:"text-base font-semibold",children:"Utilisateurs"})}),(0,e.jsx)(f,{className:"p-0",children:(0,e.jsx)(x,{className:"h-48 px-4",children:U.map(t=>(0,e.jsxs)("div",{className:"flex items-center space-x-3 py-3",children:[(0,e.jsx)(h,{id:`user-${t.id}`,checked:d.users.includes(t.id),onCheckedChange:()=>A("users",t.id),className:"h-5 w-5"}),(0,e.jsxs)("label",{htmlFor:`user-${t.id}`,className:"text-base",children:[t.firstName," ",t.lastName]}),d.users.includes(t.id)&&(0,e.jsx)("input",{type:"hidden",name:"applicableTo.users",value:t.id})]},t.id))})})]}),(0,e.jsxs)(c,{className:"shadow-none border",children:[(0,e.jsx)(p,{className:"p-4",children:(0,e.jsx)(u,{className:"text-base font-semibold",children:"Postes"})}),(0,e.jsx)(f,{className:"p-0",children:(0,e.jsx)(x,{className:"h-48 px-4",children:V.map(t=>(0,e.jsxs)("div",{className:"flex items-center space-x-3 py-3",children:[(0,e.jsx)(h,{id:`position-${t.id}`,checked:d.positions.includes(t.id),onCheckedChange:()=>A("positions",t.id),className:"h-5 w-5"}),(0,e.jsx)("label",{htmlFor:`position-${t.id}`,className:"text-base",children:t.title}),d.positions.includes(t.id)&&(0,e.jsx)("input",{type:"hidden",name:"applicableTo.positions",value:t.id})]},t.id))})})]})]})]}),(0,e.jsx)("input",{type:"hidden",name:"criteriaCount",value:m.length}),(0,e.jsx)(l,{type:"submit",className:"w-full h-11 text-base",disabled:C||v.state==="submitting",children:C||v.state==="submitting"?(0,e.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,e.jsx)(j,{className:"h-5 w-5 animate-spin"}),"Mise \xE0 jour..."]}):"Mettre \xE0 jour le formulaire KPI"})]})})]})]})]})}export{B as default};
