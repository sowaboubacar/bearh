import{a as K}from"/build/_shared/chunk-HWMDRUXM.js";import{a as q}from"/build/_shared/chunk-FB55SS72.js";import{a as D}from"/build/_shared/chunk-YDVZI2RP.js";import{a as ie}from"/build/_shared/chunk-NX6ZEDKE.js";import{a as M}from"/build/_shared/chunk-XDNDK56N.js";import{b as H}from"/build/_shared/chunk-FB4U2LCE.js";import"/build/_shared/chunk-KAUQO2FD.js";import"/build/_shared/chunk-7ZNTUDLC.js";import"/build/_shared/chunk-IQV4D3C7.js";import{a as z}from"/build/_shared/chunk-H33OI7YH.js";import{a as P,c as W}from"/build/_shared/chunk-2MHSPA7K.js";import"/build/_shared/chunk-XNZ6DBKW.js";import"/build/_shared/chunk-2BPW44Z6.js";import"/build/_shared/chunk-NGC74IU4.js";import"/build/_shared/chunk-WKQOSWRL.js";import"/build/_shared/chunk-Z5RMMUMH.js";import"/build/_shared/chunk-SUJVG5FV.js";import"/build/_shared/chunk-OMO5CWS2.js";import"/build/_shared/chunk-PVX4NJUU.js";import{a as oe}from"/build/_shared/chunk-B6OA2ZRE.js";import{a as b,b as w,c as y,d as O,e as C}from"/build/_shared/chunk-G5A27C7O.js";import{h as u}from"/build/_shared/chunk-NVGVVEPD.js";import{Ba as j,E as R,_ as F,ga as U}from"/build/_shared/chunk-PNJDYZ5P.js";import{p as A,r as E}from"/build/_shared/chunk-GTSSQFHM.js";import{a as ne,b as B}from"/build/_shared/chunk-BBTKOQ57.js";import{e as m}from"/build/_shared/chunk-UED2Q7CE.js";var r=m(ne());var ce=m(oe()),de=m(ie());var e=m(B());function V(){let{user:$,attendanceRecords:Q,can:p}=A(),s=E(),[G,J]=(0,r.useState)(new Date),[g,X]=(0,r.useState)(Q||[]),[Y,Z]=(0,r.useState)(0),[f,l]=(0,r.useState)(!1),{toast:h}=z(),[N,_]=(0,r.useState)(null),[S,ee]=(0,r.useState)(null),[x,d]=(0,r.useState)(""),[le,v]=(0,r.useState)(!1),[te,L]=(0,r.useState)(!1),ae=(t,a)=>{d(t&&a?"Position detect\xE9 avec succ\xE8s":"Erreur lors de la d\xE9tection de la position"),_(t),ee(a)};(0,r.useEffect)(()=>{let t=setInterval(()=>J(new Date),1e3);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{se()},[g]),(0,r.useEffect)(()=>{if(console.log("See this log in the browser console"),console.log(s.data),s.data&&s.data.success){if(console.log(s.data),s.data.isCheckUserLocationResponse){v(!0),d("Vous \xEAtes dans le rayon autoris\xE9"),l(!1),L(!1),h({title:"Succ\xE8s",description:"Vous \xEAtes dans le rayon autoris\xE9"});return}X(a=>{let n=a.findIndex(c=>{let o=new Date(c.date),i=new Date;return o.toDateString()===i.toDateString()});if(n!==-1){let c={...a[n]};c.entries=[...c.entries,...s.data.record.entries];let o=[...a];return o[n]=c,o}else return[...a,s.data.record]});let t=s.data.record.entries[s.data.record.entries.length-1];h({title:"Action enregistr\xE9e",description:`${I(t.type)} enregistr\xE9 \xE0 ${new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}),l(!1),d("")}else if(s.data&&s.data.error){if(L(!0),s.data.isCheckUserLocationResponse){v(!1),h({title:"Erreur",description:s.data.error,type:"error",position:"top"}),d(s.data.error),l(!1);return}h({title:"Erreur",description:s.data.error,type:"error"}),d(""),l(!1)}},[s.data]);let se=()=>{let t=0,a=null,n=new Date;n.setHours(0,0,0,0);let c=g.filter(o=>new Date(o.date).toDateString()===n.toDateString());for(let o of c)for(let i of o.entries){let T=new Date(i.timestamp).getTime();i.type==="checkIn"||i.type==="breakEnd"?a=T:(i.type==="checkOut"||i.type==="breakStart")&&a&&(t+=T-a,a=null)}a&&(t+=new Date().getTime()-a),Z(t/(1e3*60*60))},k=t=>{l(!0),s.submit({actionType:t,latitude:N,longitude:S},{method:"post"})},I=t=>({checkIn:"Arriv\xE9e",checkOut:"D\xE9part",breakStart:"D\xE9but de pause",breakEnd:"Fin de pause"})[t]||t,re=g.filter(t=>{let a=new Date(t.date),n=new Date;return a.toDateString()===n.toDateString()}).flatMap(t=>t.entries.map(a=>({action:a.type,timestamp:a.timestamp}))).sort((t,a)=>new Date(a.timestamp).getTime()-new Date(t.timestamp).getTime());return(0,e.jsxs)("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[(0,e.jsxs)(b,{className:"w-full",children:[(0,e.jsxs)(w,{className:"p-4 sm:p-6",children:[(0,e.jsxs)(y,{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-center truncate",children:["Bienvenue, ",$.firstName," !"]}),(0,e.jsx)(O,{className:"text-base sm:text-lg lg:text-xl text-center mt-2",children:G.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),(0,e.jsxs)(C,{className:"pt-2 sm:p-6",children:[!x&&(0,e.jsx)("p",{className:"text-center mt-2 mb-4 bold",children:"Que souhaitez-vous faire maintenant ?"}),x&&(0,e.jsx)(H.div,{initial:{opacity:0},animate:{opacity:1},className:" text-center bg-red text-sm mt-2 mb-2 border-emerald-800  p-2",children:(0,e.jsx)(P,{variant:te?"destructive":"default",children:(0,e.jsx)(W,{children:x})})}),(0,e.jsx)(K,{onLocationObtained:ae}),(0,e.jsx)(D,{className:"my-4 sm:my-6"}),N&&S&&(0,e.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-6",children:[p.checkIn&&(0,e.jsxs)(u,{className:"w-full h-16 sm:h-20 text-base sm:text-lg flex items-center justify-center",onClick:()=>k("checkIn"),disabled:f,children:[(0,e.jsx)(j,{className:"mr-2 h-5 w-5 sm:h-6 sm:w-6"}),"Arriv\xE9e"]}),p.checkOut&&(0,e.jsxs)(u,{className:"w-full h-16 sm:h-20 text-base sm:text-lg flex items-center justify-center",onClick:()=>k("checkOut"),variant:"secondary",disabled:f,children:[(0,e.jsx)(U,{className:"mr-2 h-5 w-5 sm:h-6 sm:w-6"}),"D\xE9part"]}),p.checkBreakStart&&(0,e.jsxs)(u,{className:"w-full h-16 sm:h-20 text-base sm:text-lg flex items-center justify-center",onClick:()=>k("breakStart"),variant:"outline",disabled:f,children:[(0,e.jsx)(R,{className:"mr-2 h-5 w-5 sm:h-6 sm:w-6"}),"D\xE9but de pause"]}),p.checkBreakEnd&&(0,e.jsxs)(u,{className:"w-full h-16 sm:h-20 text-base sm:text-lg flex items-center justify-center",onClick:()=>k("breakEnd"),variant:"outline",disabled:f,children:[(0,e.jsx)(F,{className:"mr-2 h-5 w-5 sm:h-6 sm:w-6"}),"Fin de pause"]})]}),(0,e.jsx)(D,{className:"my-4 sm:my-6"}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("h3",{className:"text-lg sm:text-xl font-semibold mb-2 sm:mb-3",children:"Temps de travail aujourd'hui"}),(0,e.jsxs)("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold",children:[Y.toFixed(2)," heures"]})]})]})]}),(0,e.jsxs)(b,{className:"w-full",children:[(0,e.jsx)(w,{className:"p-4 sm:p-6",children:(0,e.jsx)(y,{className:"text-xl sm:text-2xl font-bold",children:"Historique de pointage du jour"})}),(0,e.jsx)(C,{className:"p-4 sm:p-6",children:(0,e.jsx)(M,{className:"h-[300px] sm:h-[400px]",children:(0,e.jsx)("ul",{className:"space-y-3",children:re.map((t,a)=>(0,e.jsxs)("li",{className:"flex justify-between items-center p-3 sm:p-4 bg-muted rounded-lg",children:[(0,e.jsx)("span",{className:"text-sm sm:text-base font-medium",children:I(t.action)}),(0,e.jsx)("span",{className:"text-sm sm:text-base text-muted-foreground",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},a))})})})]})]}),(0,e.jsx)(q,{})]})}export{V as default};
