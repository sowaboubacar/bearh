import{a as Ie}from"/build/_shared/chunk-W7OEIS22.js";import{a as Je,b as Ae}from"/build/_shared/chunk-YXRCQDXR.js";import{a as Se,c as Le,d as Ue,e as Be,f as ke,g as Re,h as je,i as Pe}from"/build/_shared/chunk-3QGBS752.js";import{a as ge,b as fe,c as he,d as $,e as p,f as g}from"/build/_shared/chunk-IEDNE26R.js";import{a as V}from"/build/_shared/chunk-EJG3POZ2.js";import{a as ye,b as Te}from"/build/_shared/chunk-RHTBOEYQ.js";import"/build/_shared/chunk-HNF2M344.js";import{a as Ce,b as Fe}from"/build/_shared/chunk-IQV4D3C7.js";import{a as De}from"/build/_shared/chunk-H33OI7YH.js";import{b as ve}from"/build/_shared/chunk-SS7AQOQ3.js";import"/build/_shared/chunk-2MHSPA7K.js";import{a as D}from"/build/_shared/chunk-WZRQ3RQI.js";import"/build/_shared/chunk-XNZ6DBKW.js";import"/build/_shared/chunk-YYMCCM4Y.js";import"/build/_shared/chunk-2BPW44Z6.js";import"/build/_shared/chunk-5KYGR3MA.js";import{a as xe,d as we,e as be,g as Ne}from"/build/_shared/chunk-KLKNQD3Q.js";import"/build/_shared/chunk-PGURRWG5.js";import"/build/_shared/chunk-AQWSFLPG.js";import"/build/_shared/chunk-GFAY22KF.js";import"/build/_shared/chunk-NGC74IU4.js";import"/build/_shared/chunk-WKQOSWRL.js";import"/build/_shared/chunk-Z5RMMUMH.js";import"/build/_shared/chunk-SUJVG5FV.js";import"/build/_shared/chunk-OMO5CWS2.js";import"/build/_shared/chunk-PVX4NJUU.js";import{a as Qe}from"/build/_shared/chunk-B6OA2ZRE.js";import{a as E,b as re,c as ie,e as H}from"/build/_shared/chunk-G5A27C7O.js";import{h as n}from"/build/_shared/chunk-NVGVVEPD.js";import{Ea as O,Fa as _,I as w,Ia as ue,K as b,N as F,Na as pe,Q as ce,W as me,a as ne,k as oe,ra as de,y as M}from"/build/_shared/chunk-PNJDYZ5P.js";import{d as Y,h as ee,l as ae,p as te,r as se}from"/build/_shared/chunk-GTSSQFHM.js";import{a as Xe,b as le}from"/build/_shared/chunk-BBTKOQ57.js";import{e as x}from"/build/_shared/chunk-UED2Q7CE.js";var i=x(Xe());var Ke=x(Je());var Ye=x(Qe());var e=x(le());function Ee(){let N=Y(),{documents:s,view:He,can:m}=te(),[f,A]=(0,i.useState)([]),[y,Me]=(0,i.useState)(He==="grid"),[S,Oe]=(0,i.useState)(""),[W,z]=(0,i.useState)(s.results),[L,U]=(0,i.useState)(null),[d,Z]=(0,i.useState)(null),[h,_e]=ee(),[$e,T]=(0,i.useState)({}),[B,k]=(0,i.useState)(!1),R=(0,i.useRef)(null),{toast:j}=De(),[l,v]=(0,i.useState)(null),o=se(),[G,q]=(0,i.useState)(null);(0,i.useEffect)(()=>{z(s?.results?.filter(a=>a.label?.toLowerCase().includes(S?.toLowerCase())))},[s.results,S]),(0,i.useEffect)(()=>{o?.state==="idle"?(Ae({title:"Succ\xE8s",message:d==="upload"?"Fichier(s) t\xE9l\xE9charg\xE9(s) avec succ\xE8s!":d==="update"?"Fichier mis \xE0 jour avec succ\xE8s!":d==="delete"?"Fichier supprim\xE9 avec succ\xE8s!":"Action termin\xE9e avec succ\xE8s",layoutStyle:"macos",type:"success",onClose:()=>{P()}}),o.data?.success&&(j({title:"Succ\xE8s",description:d==="upload"?"Fichier(s) t\xE9l\xE9charg\xE9(s) avec succ\xE8s!":d==="update"?"Fichier mis \xE0 jour avec succ\xE8s!":d==="delete"?"Fichier supprim\xE9 avec succ\xE8s!":"Action termin\xE9e avec succ\xE8s"}),d==="upload"&&P())):o.data?.error&&(j({title:"Erreur",description:`Erreur: ${o.data?.error}`,variant:"destructive"}),P())},[o.state,o.data,d,j]);let P=()=>{R.current&&(R.current.reset(),A([]),T({}))},Ve=a=>{if(Array.from(a).filter(c=>c.size>1048576).length>0){q(`Un ou plusieurs fichiers d\xE9passent la taille maximale autoris\xE9e de ${1048576/1024/1024} MB.`),k(!1);return}let u=Array.from(a).map(c=>({file:c,progress:0,previewUrl:c.type.startsWith("image/")?URL.createObjectURL(c):void 0}));A(c=>[...c,...u])},We=()=>{q(null),k(!0)},ze=a=>{A(t=>{let r=[...t];return r[a].previewUrl&&URL.revokeObjectURL(r[a].previewUrl),r.splice(a,1),r}),T(t=>{let r={...t};return delete r[a],r})},Ze=a=>{a.preventDefault();let t=new FormData(a.currentTarget);t.append("_action","upload"),Z("upload"),f.forEach((u,c)=>{t.append("files",u.file)});let r=o.submit(t,{method:"post",encType:"multipart/form-data",action:"/api/media"});f.forEach((u,c)=>{let C=0,K=setInterval(()=>{C+=Math.random()*10,C>90&&(clearInterval(K),C=90),T(I=>({...I,[c]:Math.round(C)}))},200);r.then(()=>{clearInterval(K),T(I=>({...I,[c]:100}))})})},X=a=>{U(a)},Ge=()=>{if(L){let a=new FormData;a.append("_action","delete"),Z("delete"),a.append("documentId",L),o.submit(a,{method:"post",encType:"multipart/form-data",action:"/api/media"}),U(null)}},qe=()=>{let a=!y;Me(a),h.set("view",a?"grid":"list"),_e(h)},Q=(a,t)=>{let r=new FormData;r.append("_action","update"),r.append("documentId",a),r.append("label",t),o.submit(r,{method:"post",encType:"multipart/form-data",action:"/api/media"})},J=(a,t)=>{z(r=>r.map(u=>u.id===a?{...u,label:t}:u))};return(0,e.jsx)(Ce,{children:(0,e.jsxs)("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[(0,e.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"Gestionnaire de m\xE9dias"}),m?.upload&&(0,e.jsx)(n,{onClick:()=>k(!B),className:"w-full sm:w-auto h-12 text-base mb-6",children:B?"Masquer la zone de t\xE9l\xE9chargement":"T\xE9l\xE9charger des fichiers"}),G&&(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("p",{className:"text-red-500 font-medium mb-4",children:G}),(0,e.jsx)(n,{onClick:We,children:"Ressayer"})]}),m?.upload&&B&&(0,e.jsxs)(E,{className:"mb-8",children:[(0,e.jsx)(re,{className:"p-4 sm:p-6",children:(0,e.jsx)(ie,{className:"text-xl sm:text-2xl",children:"T\xE9l\xE9charger des fichiers"})}),(0,e.jsx)(H,{className:"p-4 sm:p-6",children:(0,e.jsxs)(ae,{ref:R,onSubmit:Ze,className:"space-y-6",children:[(0,e.jsx)(Te,{maxSize:"1MB",multiple:!0,accept:"image/*,application/pdf,.doc,.docx,.xls,.xlsx",onFileSelect:Ve}),f.length>0&&(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:f?.map((a,t)=>(0,e.jsx)(ye,{file:a.file,progress:$e[t]||0,previewUrl:a.previewUrl,onRemove:()=>ze(t)},t))}),f.length>0&&(0,e.jsx)(n,{type:"submit",className:"w-full h-12 text-base",disabled:o.state!=="idle",children:o.state!=="idle"?"T\xE9l\xE9chargement...":`T\xE9l\xE9charger ${f.length} fichier${f.length===1?"":"s"}`})]})})]}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[(0,e.jsx)(ve,{htmlFor:"view-toggle",className:"text-base",children:"Vue :"}),(0,e.jsx)(Ie,{id:"view-toggle",checked:y,onCheckedChange:qe}),(0,e.jsx)("span",{className:"text-xl",children:y?(0,e.jsx)(ce,{}):(0,e.jsx)(me,{})})]}),(0,e.jsxs)("div",{className:"relative w-full sm:w-auto sm:min-w-[300px]",children:[(0,e.jsx)(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,e.jsx)(D,{type:"text",placeholder:"Rechercher des fichiers...",value:S,onChange:a=>Oe(a.target.value),className:"pl-10 h-12 text-base w-full"})]})]}),s.results.length>0&&(0,e.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row justify-center items-center gap-4 mb-2",children:[(0,e.jsx)(n,{variant:"outline",onClick:()=>{let a=new URLSearchParams(h);a.set("page",(s.page-1).toString()),N(`?${a.toString()}`)},disabled:s.page===1,className:"w-full sm:w-auto h-12 text-base",children:"Pr\xE9c\xE9dent"}),(0,e.jsxs)("span",{className:"text-base",children:["Page ",s.page," / ",s.totalResults," media(s)"]}),(0,e.jsx)(n,{variant:"outline",onClick:()=>{let a=new URLSearchParams(h);a.set("page",(s.page+1).toString()),N(`?${a.toString()}`)},disabled:s.page===s.totalPages,className:"w-full sm:w-auto h-12 text-base",children:"Suivant"})]}),y?(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:W?.map(a=>(0,e.jsx)(E,{children:(0,e.jsxs)(H,{className:"p-4 sm:p-6",children:[(0,e.jsx)("div",{className:"aspect-square bg-gray-100 flex items-center justify-center mb-4 relative group",children:a.file.meta.mimeType.startsWith("image/")?(0,e.jsx)("img",{src:a.file.url,alt:a.label,className:"max-w-full max-h-full object-contain"}):a.file.meta.mimeType.startsWith("video/")?(0,e.jsxs)("div",{className:"relative cursor-pointer w-full h-full",onClick:()=>{m?.view&&v(a)},children:[(0,e.jsx)("video",{src:a.file.url,className:"max-w-full max-h-full object-contain",preload:"metadata",children:(0,e.jsx)("track",{kind:"captions"})}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40",children:(0,e.jsx)(M,{className:"w-16 h-16 text-white"})})]}):(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 text-center truncate",children:[(0,e.jsx)(F,{className:"w-16 h-16 text-gray-400"}),(0,e.jsx)("span",{className:"mt-3 text-sm text-gray-500 uppercase truncate",children:a.file.meta.extension||"fichier"})]})}),m?.edit&&(0,e.jsx)(D,{value:a.label,onChange:t=>J(a.id,t.target.value),onBlur:t=>Q(a.id,t.target.value),className:"mb-3 h-12 text-base"}),(0,e.jsx)("p",{className:"text-base text-gray-500 mb-1 truncate",children:a.file.meta.mimeType}),(0,e.jsx)("p",{className:"text-base text-gray-500 mb-3",children:V(a.file.meta.size)}),(0,e.jsxs)("div",{className:"border-t pt-3 mb-3",children:[(0,e.jsxs)("p",{className:"flex items-center text-base mt-2",children:[(0,e.jsx)(ne,{className:"mr-2 h-5 w-5"})," ",a.uploadedBy?.firstName," ",a.uploadedBy?.lastName]}),a.status==="permanent"&&(0,e.jsxs)("p",{className:"flex items-center text-base mt-2",children:[(0,e.jsx)(_,{className:"mr-2 h-5 w-5"}),a.usedBy.length," utilisation(s)"]})]}),(0,e.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,e.jsx)(n,{variant:"outline",className:"flex-1 h-12 text-base",onClick:()=>{m?.view&&v(a)},children:(0,e.jsx)(b,{className:"mr-2 h-5 w-5"})}),m?.delete&&(0,e.jsx)(n,{variant:"destructive",className:"flex-1 h-12 text-base",disabled:a.status==="permanent"||a.usedBy.length>0,onClick:()=>X(a.id),children:(0,e.jsx)(O,{className:"mr-2 h-5 w-5"})})]})]})},a.id))}):(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)(ge,{children:[(0,e.jsx)(fe,{children:(0,e.jsxs)($,{children:[(0,e.jsx)(p,{className:"text-base",children:"Aper\xE7u"}),(0,e.jsx)(p,{className:"text-base",children:"\xC9tiquette"}),(0,e.jsx)(p,{className:"text-base hidden md:table-cell",children:"Type de fichier"}),(0,e.jsx)(p,{className:"text-base hidden sm:table-cell",children:"Taille"}),(0,e.jsx)(p,{className:"text-base",children:"Par"}),(0,e.jsx)(p,{className:"text-base hidden lg:table-cell",children:"Usage"}),(0,e.jsx)(p,{className:"text-base",children:"Actions"})]})}),(0,e.jsx)(he,{children:W?.map(a=>(0,e.jsxs)($,{children:[(0,e.jsx)(g,{children:(0,e.jsx)("div",{className:"relative",children:a.file.meta.mimeType.startsWith("image/")?(0,e.jsx)("img",{src:a.file.url,alt:a.label,className:"w-16 h-16 object-cover rounded"}):a.file.meta.mimeType.startsWith("video/")?(0,e.jsxs)("div",{className:"relative cursor-pointer",onClick:()=>{m?.view&&v(a)},children:[(0,e.jsx)("video",{src:a.file.url,className:"w-16 h-16 object-cover rounded",preload:"metadata",children:(0,e.jsx)("track",{kind:"captions"})}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded",children:(0,e.jsx)(M,{className:"w-8 h-8 text-white"})})]}):(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center w-16 h-16",children:[(0,e.jsx)(F,{className:"w-12 h-12 text-gray-400"}),(0,e.jsx)("span",{className:"text-xs text-gray-500 uppercase truncate",children:a.file.meta.extension||"fichier"})]})})}),(0,e.jsx)(g,{children:m?.edit&&(0,e.jsx)(D,{value:a.label,onChange:t=>J(a.id,t.target.value),onBlur:t=>Q(a.id,t.target.value),className:"h-12 text-base min-w-[200px]"})}),(0,e.jsx)(g,{className:"hidden md:table-cell text-base truncate",children:a.file.meta.extension}),(0,e.jsx)(g,{className:"hidden sm:table-cell text-base",children:V(a.file.meta.size)}),(0,e.jsxs)(g,{className:"text-base",children:[a.uploadedBy?.firstName," ",a.uploadedBy?.lastName]}),(0,e.jsx)(g,{className:"hidden lg:table-cell text-base",children:a.status==="permanent"&&a.usedBy.length}),(0,e.jsx)(g,{children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(n,{variant:"outline",className:"h-12 text-base px-3",onClick:()=>{m?.view&&v(a)},children:(0,e.jsx)(b,{className:"h-5 w-5"})}),m?.delete&&(0,e.jsx)(n,{variant:"destructive",className:"h-12 text-base px-3",disabled:a.status==="permanent"||a.usedBy.length>0,onClick:()=>X(a.id),children:(0,e.jsx)(O,{className:"h-5 w-5"})})]})})]},a.id))})]})}),s.totalResults<1?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsx)("p",{className:"text-xl text-gray-500",children:"Aucun fichier trouv\xE9. Veuillez t\xE9lverser des fichiers."})}):null,s.results.length>0&&(0,e.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row justify-center items-center gap-4 mb-2",children:[(0,e.jsx)(n,{variant:"outline",onClick:()=>{let a=new URLSearchParams(h);a.set("page",(s.page-1).toString()),N(`?${a.toString()}`)},disabled:s.page===1,className:"w-full sm:w-auto h-12 text-base",children:"Pr\xE9c\xE9dent"}),(0,e.jsxs)("span",{className:"text-base",children:["Page ",s.page," / ",s.totalResults," media(s)"]}),(0,e.jsx)(n,{variant:"outline",onClick:()=>{let a=new URLSearchParams(h);a.set("page",(s.page+1).toString()),N(`?${a.toString()}`)},disabled:s.page===s.totalPages,className:"w-full sm:w-auto h-12 text-base",children:"Suivant"})]}),(0,e.jsx)(Se,{open:!!L,onOpenChange:()=>U(null),children:(0,e.jsxs)(Le,{className:"max-w-md",children:[(0,e.jsxs)(Ue,{children:[(0,e.jsx)(ke,{className:"text-xl",children:"\xCAtes-vous s\xFBr de vouloir supprimer ce fichier ?"}),(0,e.jsx)(Re,{className:"text-base",children:"Cette action ne peut pas \xEAtre annul\xE9e. Cela supprimera d\xE9finitivement le fichier."})]}),(0,e.jsxs)(Be,{className:"gap-3",children:[(0,e.jsx)(Pe,{className:"h-12 text-base",children:"Annuler"}),(0,e.jsx)(je,{onClick:Ge,className:"h-12 text-base",children:"Supprimer"})]})]})}),(0,e.jsx)(xe,{open:!!l,onOpenChange:()=>v(null),children:(0,e.jsxs)(we,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col sm:p-6",children:[(0,e.jsx)(be,{children:(0,e.jsx)(Ne,{className:"text-xl sm:text-2xl",children:l?.label||"Aper\xE7u du fichier"})}),(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-auto p-4",children:l?.file.meta.mimeType.startsWith("image/")?(0,e.jsx)("img",{src:l.file.url,alt:l.label||"Aper\xE7u",className:"max-w-full max-h-full object-contain"}):l?.file.meta.mimeType.startsWith("video/")?(0,e.jsxs)("video",{src:l.file.url,controls:!0,preload:"metadata",playsInline:!0,className:"max-w-full max-h-[70vh] object-contain",children:[(0,e.jsx)("track",{kind:"captions",src:"",srcLang:"fr",label:"Fran\xE7ais"}),"Votre navigateur ne prend pas en charge la lecture de vid\xE9os."]}):(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 bg-muted rounded-lg",children:[(0,e.jsx)(F,{className:"w-20 h-20 text-muted-foreground mb-4"}),(0,e.jsxs)("a",{href:l?.file.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium text-lg",children:["T\xE9l\xE9charger ",l?.label||"le fichier"]})]})}),(0,e.jsx)("div",{className:"mt-4 text-sm text-muted-foreground px-4 text-center",children:(0,e.jsxs)("p",{className:"space-x-2 text-[11px] xs:text-xs text-muted-foreground font-semibold sm:mb-6",children:[(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(oe,{className:"h-4 w-4 mr-1"}),new Date(l?.updatedAt).toLocaleString(),(0,e.jsx)("span",{children:(0,e.jsx)(w,{})})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(pe,{className:"h-4 w-4 mr-1"}),l?.owner?.firstName," ",l?.owner?.lastName,(0,e.jsx)("span",{children:(0,e.jsx)(w,{})})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(ue,{className:"h-4 w-4 mr-1"}),l?.uploadedBy?.firstName," ",l?.uploadedBy?.lastName,(0,e.jsx)("span",{children:(0,e.jsx)(w,{})})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(_,{className:"h-4 w-4 mr-1"}),"Utilis\xE9"," ",l?.status==="permanent"?l?.usedBy.length:0," ","fois",(0,e.jsxs)("span",{children:[" ",(0,e.jsx)(w,{})]})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(b,{className:"h-4 w-4 mr-1"}),l?.availableFor?.access==="all"?"Tous":"Restreint"]})]})})]})}),(0,e.jsx)(Fe,{className:"fixed bottom-0 right-0 flex flex-col gap-2 p-4 sm:p-6 max-w-[90vw] sm:max-w-[420px]"})]})})}export{Ee as default};
