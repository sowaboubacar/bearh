import{a as Ie,b as pe}from"/build/_shared/chunk-YXRCQDXR.js";import{a as ue,c as de,d as fe,e as ge,f as he,g as ve,h as xe,i as we}from"/build/_shared/chunk-3QGBS752.js";import{a as te}from"/build/_shared/chunk-LZOQ52E6.js";import"/build/_shared/chunk-MRGZKXS3.js";import{b as x}from"/build/_shared/chunk-FB4U2LCE.js";import{a as je}from"/build/_shared/chunk-6JFOYO3V.js";import{a as me}from"/build/_shared/chunk-EJG3POZ2.js";import{a as le,b as ne}from"/build/_shared/chunk-RHTBOEYQ.js";import"/build/_shared/chunk-HNF2M344.js";import{a as oe}from"/build/_shared/chunk-IQV4D3C7.js";import{a as ce}from"/build/_shared/chunk-H33OI7YH.js";import"/build/_shared/chunk-2MHSPA7K.js";import{a as k}from"/build/_shared/chunk-WZRQ3RQI.js";import"/build/_shared/chunk-XNZ6DBKW.js";import"/build/_shared/chunk-2BPW44Z6.js";import{a as ae,d as se,e as re,g as ie}from"/build/_shared/chunk-KLKNQD3Q.js";import"/build/_shared/chunk-PGURRWG5.js";import"/build/_shared/chunk-AQWSFLPG.js";import"/build/_shared/chunk-GFAY22KF.js";import"/build/_shared/chunk-NGC74IU4.js";import"/build/_shared/chunk-WKQOSWRL.js";import"/build/_shared/chunk-Z5RMMUMH.js";import"/build/_shared/chunk-SUJVG5FV.js";import"/build/_shared/chunk-OMO5CWS2.js";import"/build/_shared/chunk-PVX4NJUU.js";import{a as ke}from"/build/_shared/chunk-B6OA2ZRE.js";import{a as P,b as Z,c as q,e as L}from"/build/_shared/chunk-G5A27C7O.js";import{h as p}from"/build/_shared/chunk-NVGVVEPD.js";import{Ea as X,Fa as R,I as f,Ia as Y,K as v,N as B,Na as ee,a as G,k as Q,ra as K,y as J}from"/build/_shared/chunk-PNJDYZ5P.js";import{d as W,h as $,l as O,p as _,r as z}from"/build/_shared/chunk-GTSSQFHM.js";import{a as Re,b as V}from"/build/_shared/chunk-BBTKOQ57.js";import{e as d}from"/build/_shared/chunk-UED2Q7CE.js";var Ee=d(Ie());var He=d(ke());var i=d(Re());var Me=d(je());var e=d(V());function be(){let j=W(),{documents:l,user:Ne,can:c}=_(),[m,w]=(0,i.useState)([]),[b,ye]=(0,i.useState)(""),[De,I]=(0,i.useState)(l.results),[o,E]=(0,i.useState)(null),[H,We]=$(),[N,y]=(0,i.useState)(null),[Fe,g]=(0,i.useState)({}),[D,Ce]=(0,i.useState)(!1),F=(0,i.useRef)(null),{toast:C}=ce(),[r,T]=(0,i.useState)(null),n=z();(0,i.useEffect)(()=>{I(l?.results?.filter(t=>t.label?.toLowerCase().includes(b?.toLowerCase())))},[l.results,b]),(0,i.useEffect)(()=>{n?.state==="idle"?(pe({title:"Succ\xE8s",message:o==="upload"?"Fichier(s) t\xE9l\xE9charg\xE9(s) avec succ\xE8s!":o==="update"?"Fichier mis \xE0 jour avec succ\xE8s!":o==="delete"?"Fichier supprim\xE9 avec succ\xE8s!":"Action termin\xE9e avec succ\xE8s",layoutStyle:"macos",type:"success",onClose:()=>{A()}}),n.data?.success&&(C({title:"Succ\xE8s",description:o==="upload"?"Fichier(s) t\xE9l\xE9charg\xE9(s) avec succ\xE8s!":o==="update"?"Fichier mis \xE0 jour avec succ\xE8s!":o==="delete"?"Fichier supprim\xE9 avec succ\xE8s!":"Action termin\xE9e avec succ\xE8s"}),o==="upload"&&A())):n.data?.error&&(C({title:"Erreur",description:`Erreur: ${n.data?.error}`,variant:"destructive"}),A())},[n.state,n.data,o,C]);let A=()=>{F.current&&(F.current.reset(),w([]),g({}))},Te=t=>{let s=Array.from(t).map(a=>({file:a,progress:0,previewUrl:a.type.startsWith("image/")?URL.createObjectURL(a):void 0}));w(a=>[...a,...s])},Ae=t=>{w(s=>{let a=[...s];return a[t].previewUrl&&URL.revokeObjectURL(a[t].previewUrl),a.splice(t,1),a}),g(s=>{let a={...s};return delete a[t],a})},Ue=t=>{t.preventDefault();let s=new FormData(t.currentTarget);s.append("_action","upload"),E("upload"),m.forEach((u,U)=>{s.append("files",u.file)});let a=n.submit(s,{method:"post",encType:"multipart/form-data",action:"/api/media"});m.forEach((u,U)=>{let h=0,M=setInterval(()=>{h+=Math.random()*10,h>90&&(clearInterval(M),h=90),g(S=>({...S,[U]:Math.round(h)}))},200);a.then(()=>{clearInterval(M),g(S=>({...S,[U]:100}))})})},Se=t=>{y(t)},Pe=()=>{if(N){let t=new FormData;t.append("_action","delete"),E("delete"),t.append("documentId",N),n.submit(t,{method:"post",encType:"multipart/form-data",action:"/api/media"}),y(null)}},Le=(t,s)=>{let a=new FormData;a.append("_action","update"),a.append("documentId",t),a.append("label",s),n.submit(a,{method:"post",encType:"multipart/form-data",action:"/api/media"})},Be=(t,s)=>{I(a=>a.map(u=>u.id===t?{...u,label:s}:u))};return(0,e.jsxs)(x.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"container mx-auto p-4 space-y-6 max-w-6xl",children:[(0,e.jsxs)(x.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.5},className:"mb-6",children:[(0,e.jsx)(te,{user:Ne,can:c}),(0,e.jsx)("h1",{className:"text-3xl font-bold mt-4 text-center",children:"Documents et Fichiers"})]}),(0,e.jsx)(x.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.5},children:(0,e.jsx)(oe,{children:(0,e.jsxs)("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8 justify-center text-center",children:[c?.documents?.upload&&(0,e.jsx)(p,{onClick:()=>Ce(!D),className:"w-full sm:w-auto h-12 text-base mb-6",children:D?"Masquer la zone de t\xE9l\xE9chargement":"T\xE9l\xE9charger des fichiers"}),c?.documents?.upload&&D&&(0,e.jsxs)(P,{className:"mb-8 text-center justify-center",children:[(0,e.jsx)(Z,{className:"p-4 sm:p-6",children:(0,e.jsx)(q,{className:"text-xl sm:text-2xl",children:"T\xE9l\xE9charger des fichiers"})}),(0,e.jsx)(L,{className:"p-4 sm:p-6",children:(0,e.jsxs)(O,{ref:F,onSubmit:Ue,className:"space-y-6",children:[(0,e.jsx)(ne,{maxSize:"5MB",multiple:!0,accept:"image/*,application/pdf,.doc,.docx,.xls,.xlsx",onFileSelect:Te}),m.length>0&&(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:m?.map((t,s)=>(0,e.jsx)(le,{file:t.file,progress:Fe[s]||0,previewUrl:t.previewUrl,onRemove:()=>Ae(s)},s))}),m.length>0&&(0,e.jsx)(p,{type:"submit",className:"w-full h-12 text-base",disabled:n.state!=="idle",children:n.state!=="idle"?"T\xE9l\xE9chargement...":`T\xE9l\xE9charger ${m.length} fichier${m.length===1?"":"s"}`})]})})]}),(0,e.jsx)("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mb-6 mx-auto",children:(0,e.jsxs)("div",{className:"relative w-full sm:w-auto sm:min-w-[300px] text-center",children:[(0,e.jsx)(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,e.jsx)(k,{type:"text",placeholder:"Rechercher des fichiers...",value:b,onChange:t=>ye(t.target.value),className:"pl-10 h-12 text-base w-full  rounded-full border-2 border-primary"})]})}),l.results.length>0&&(0,e.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row justify-center items-center gap-4 mb-2",children:[(0,e.jsx)(p,{variant:"outline",onClick:()=>{let t=new URLSearchParams(H);t.set("page",(l.page-1).toString()),j(`?${t.toString()}`)},disabled:l.page===1,className:"w-full sm:w-auto h-12 text-base",children:"Pr\xE9c\xE9dent"}),(0,e.jsxs)("span",{className:"text-base",children:["Page ",l.page," / ",l.totalResults," media(s)"]}),(0,e.jsx)(p,{variant:"outline",onClick:()=>{let t=new URLSearchParams(H);t.set("page",(l.page+1).toString()),j(`?${t.toString()}`)},disabled:l.page===l.totalPages,className:"w-full sm:w-auto h-12 text-base",children:"Suivant"})]}),(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:De?.map(t=>(0,e.jsx)(P,{children:(0,e.jsxs)(L,{className:"p-4 sm:p-6",children:[(0,e.jsx)("div",{className:"aspect-square bg-gray-100 flex items-center justify-center mb-4 relative group",children:t.file.meta.mimeType.startsWith("image/")?(0,e.jsx)("img",{src:t.file.url,alt:t.label,className:"max-w-full max-h-full object-contain"}):t.file.meta.mimeType.startsWith("video/")?(0,e.jsxs)("div",{className:"relative cursor-pointer w-full h-full",onClick:()=>{c?.documents.view&&T(t)},children:[(0,e.jsx)("video",{src:t.file.url,className:"max-w-full max-h-full object-contain",preload:"metadata",children:(0,e.jsx)("track",{kind:"captions"})}),(0,e.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40",children:(0,e.jsx)(J,{className:"w-16 h-16 text-white"})})]}):(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 text-center truncate",children:[(0,e.jsx)(B,{className:"w-16 h-16 text-gray-400"}),(0,e.jsx)("span",{className:"mt-3 text-sm text-gray-500 uppercase truncate",children:t.file.meta.extension||"fichier"})]})}),c?.documents.edit&&(0,e.jsx)(k,{value:t.label,onChange:s=>Be(t.id,s.target.value),onBlur:s=>Le(t.id,s.target.value),className:"mb-3 h-12 text-base"}),(0,e.jsx)("p",{className:"text-base text-gray-500 mb-1 truncate",children:t.file.meta.mimeType}),(0,e.jsx)("p",{className:"text-base text-gray-500 mb-3",children:me(t.file.meta.size)}),(0,e.jsxs)("div",{className:"border-t pt-3 mb-3",children:[(0,e.jsxs)("p",{className:"flex items-center text-base mt-2",children:[(0,e.jsx)(G,{className:"mr-2 h-5 w-5"})," ",t.uploadedBy?.firstName," ",t.uploadedBy?.lastName]}),t.status==="permanent"&&(0,e.jsxs)("p",{className:"flex items-center text-base mt-2",children:[(0,e.jsx)(R,{className:"mr-2 h-5 w-5"}),t.usedBy.length," utilisation(s)"]})]}),(0,e.jsxs)("div",{className:"flex justify-between gap-3",children:[c?.documents?.view&&(0,e.jsx)(p,{variant:"outline",className:"flex-1 h-12 text-base",onClick:()=>T(t),children:(0,e.jsx)(v,{className:"mr-2 h-5 w-5"})}),c?.documents?.delete&&(0,e.jsx)(p,{variant:"destructive",className:"flex-1 h-12 text-base",disabled:t.status==="permanent"||t.usedBy.length>0||!0,onClick:()=>Se(t.id),children:(0,e.jsx)(X,{className:"mr-2 h-5 w-5"})})]})]})},t.id))})]})})}),(0,e.jsx)(ue,{open:!!N,onOpenChange:()=>y(null),children:(0,e.jsxs)(de,{className:"max-w-md",children:[(0,e.jsxs)(fe,{children:[(0,e.jsx)(he,{className:"text-xl",children:"\xCAtes-vous s\xFBr de vouloir supprimer ce fichier ?"}),(0,e.jsx)(ve,{className:"text-base",children:"Cette action ne peut pas \xEAtre annul\xE9e. Cela supprimera d\xE9finitivement le fichier."})]}),(0,e.jsxs)(ge,{className:"gap-3",children:[(0,e.jsx)(we,{className:"h-12 text-base",children:"Annuler"}),(0,e.jsx)(xe,{onClick:Pe,className:"h-12 text-base",children:"Supprimer"})]})]})}),(0,e.jsx)(ae,{open:!!r,onOpenChange:()=>T(null),children:(0,e.jsxs)(se,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col sm:p-6",children:[(0,e.jsx)(re,{children:(0,e.jsx)(ie,{className:"text-xl sm:text-2xl",children:r?.label||"Aper\xE7u du fichier"})}),(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-auto p-4",children:r?.file.meta.mimeType.startsWith("image/")?(0,e.jsx)("img",{src:r.file.url,alt:r.label||"Aper\xE7u",className:"max-w-full max-h-full object-contain"}):r?.file.meta.mimeType.startsWith("video/")?(0,e.jsxs)("video",{src:r.file.url,controls:!0,preload:"metadata",playsInline:!0,className:"max-w-full max-h-[70vh] object-contain",children:[(0,e.jsx)("track",{kind:"captions",src:"",srcLang:"fr",label:"Fran\xE7ais"}),"Votre navigateur ne prend pas en charge la lecture de vid\xE9os."]}):(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 bg-muted rounded-lg",children:[(0,e.jsx)(B,{className:"w-20 h-20 text-muted-foreground mb-4"}),(0,e.jsxs)("a",{href:r?.file.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 font-medium text-lg",children:["T\xE9l\xE9charger ",r?.label||"le fichier"]})]})}),(0,e.jsx)("div",{className:"mt-4 text-sm text-muted-foreground px-4 text-center",children:(0,e.jsxs)("p",{className:"space-x-2 text-[11px] xs:text-xs text-muted-foreground font-semibold sm:mb-6",children:[(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(Q,{className:"h-4 w-4 mr-1"}),new Date(r?.updatedAt).toLocaleString(),(0,e.jsx)("span",{children:(0,e.jsx)(f,{})})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(ee,{className:"h-4 w-4 mr-1"}),r?.owner?.firstName," ",r?.owner?.lastName,(0,e.jsx)("span",{children:(0,e.jsx)(f,{})})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(Y,{className:"h-4 w-4 mr-1"}),r?.uploadedBy?.firstName," ",r?.uploadedBy?.lastName,(0,e.jsx)("span",{children:(0,e.jsx)(f,{})})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(R,{className:"h-4 w-4 mr-1"}),"Utilis\xE9"," ",r?.status==="permanent"?r?.usedBy.length:0," ","fois",(0,e.jsxs)("span",{children:[" ",(0,e.jsx)(f,{})]})]}),(0,e.jsxs)("span",{className:"inline-flex items-center",children:[(0,e.jsx)(v,{className:"h-4 w-4 mr-1"}),r?.availableFor?.access==="all"?"Tous":"Restreint"]})]})})]})})]})}export{be as default};
